- name: generate {{ domain }}.conf
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    backup: yes
  with_items:
    - {"src": "nginx_conf_template", "dest": "{{ nginx_conf_dir }}/{{ domain }}.conf"}
  become: yes
  become_method: sudo


- name: test nginx file
  command: /opt/nginx/sbin/nginx -t
